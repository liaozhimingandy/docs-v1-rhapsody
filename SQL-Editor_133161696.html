<!doctype html>
<html>
 <head> 
  <title>SQL Editor</title> 
  <link rel="stylesheet" href="styles/site.css" type="text/css"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <link rel="stylesheet" href="styles/icons.css" type="text/css">
  <script src="js/jquery.min.js"></script>
  <script src="tree/collapsibleTreeMenu.js"></script>
  <link href="tree/collapsibleTreeMenu.css" rel="stylesheet" type="text/css">
 </head> 
 <body class="theme-default aui-theme-default"> 
  <div id="page"> 
   <div id="main" class="aui-page-panel"> 
    <div id="main-header"> 
     <div id="breadcrumb-section"> 
      <ol id="breadcrumbs">  
       <li> <span><a href="Rhapsody-Integration-Engine-6.5_133160975.html">Rhapsody Integration Engine 6.5</a></span> </li> 
       <li> <span><a href="Developing-Rhapsody_133161055.html">Developing Rhapsody</a></span> </li> 
       <li> <span><a href="Database-Configuration_133161571.html">Database Configuration</a></span> </li> 
      </ol> 
     </div> 
     <h1 id="title-heading" class="pagetitle"> <span id="title-text">SQL Editor</span> </h1> 
    </div> 
    <div id="content" class="view">  
     <div id="main-content" class="wiki-content group"> 
      <p>The&nbsp;<strong>SQL Editor</strong>&nbsp;is used to edit individual SQL statements that will be run in the database configuration.&nbsp;It enables you to write SQL statements, insert field paths, and access results from previous statements. In addition, it enables you to place SQL comments within the SQL code itself, making it easier to document the exact behavior of a particular query.</p>
      <p><span style="color: rgb(51,51,51);font-size: 20.0px;letter-spacing: -0.008em;">Launching the&nbsp;</span><span style="color: rgb(51,51,51);font-size: 20.0px;letter-spacing: -0.008em;">SQL Editor</span></p>
      <p>To open the&nbsp;<strong>SQL Editor</strong>, double-click on the statement you want to maintain from the<strong>&nbsp;Database Configuration Editor</strong>. Alternatively, select the statement and then select the&nbsp;<strong>Edit Statement</strong>&nbsp;icon&nbsp;<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/148510894.png" data-image-src="attachments/133161696/148510894.png" data-unresolved-comment-count="0" data-linked-resource-id="148510894" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="window_edit24x24.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span>&nbsp;from the Statement Toolbar. The&nbsp;<strong>SQL Editor</strong>&nbsp;is then displayed.</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/148510895.png" data-image-src="attachments/133161696/148510895.png" data-unresolved-comment-count="0" data-linked-resource-id="148510895" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="sqlEditor.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span>&nbsp;</p>
      <p>The&nbsp;<strong>SQL Editor</strong>&nbsp;consists of the following key sections:</p>
      <div class="table-wrap">
       <table id="TBL1565043148454" class="wrapped confluenceTable" width="100%">
        <colgroup>
         <col>
         <col>
        </colgroup>
        <tbody>
         <tr>
          <th class="confluenceTh"><p>Section</p></th>
          <th class="confluenceTh"><p>Description</p></th>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Statement</p></td>
          <td class="confluenceTd"><p>The name of the SQL Statement. Click the <strong>Rename</strong> link to display the <strong>Rename Statement</strong> screen, which enables you to enter a new name for the statement. By default, when the statement is created, the statement is assigned a name <code>New Statement</code>.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Comments</p></td>
          <td class="confluenceTd"><p>Enter any comments for this statement. Comments are shown on the <strong> Database Configuration Editor</strong> and enable users to quickly identify the purpose of the statement.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>SQL Text Editor Pane</p></td>
          <td class="confluenceTd">
           <div class="content-wrapper">
            <p>The SQL Text Editor is a color-coded text editor that supports SQL. It allows the SQL statements to be written, field paths to be easily inserted, and results from previous statements to be accessed. In addition, it allows SQL comments to be placed within the SQL code itself, making it easier to document the exact behavior of a particular query. Refer to <a href="SQL-Editor_133161696.html">SQL Editor</a> for details.</p>
            <div class="confluence-information-macro confluence-information-macro-note">
             <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
             <div class="confluence-information-macro-body">
              <p class="p1">Database components can only process one result set from a <code>SELECT</code> query. Therefore you should provide one <code>SELECT</code> query per statement.</p>
             </div>
            </div>
           </div></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Result Substitution Panel</p></td>
          <td class="confluenceTd"><p>Once queries have been executed, the results can be inserted into either message properties, fields, or both. Result substitution is primarily used within a <a href="Database-Lookup-Filter_133161782.html">Database Lookup filter</a> and the <a href="Database_133162443.html">Database communication point</a> in <em>Out-&gt;In</em> mode, where a message is being updated with some values retrieved via one or more database queries. Refer to <a href="Result-Substitution_133161688.html">Result Substitution</a> for details.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Server Explorer</p></td>
          <td class="confluenceTd"><p>Displays the database tables, views, and stored procedures. This allows easy reference to the database.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Message Structure</p></td>
          <td class="confluenceTd"><p>Displays the message structure. This allows easy reference to the message definition and enables you to drag and drop message properties into your query.</p></td>
         </tr>
        </tbody> 
        <script type="text/javascript">

$("table[id='TBL1565043148454']").data("appfire-table","true");
(new org_swift_TableSorter()).customTable('TBL1565043148454',[],'style=&quot;width:20%; text-align: left;&quot;',
1,'',true,
'Click to sort','',false,
false,false,false,
0,false,'',true,
'',false,false,'','100%','','',
true,'',
''
);

</script> 
       </table>
      </div>
      <h2 id="SQLEditor-SQLGeneration"><span style="color: rgb(51,51,51);">SQL Generation</span></h2>
      <p>While SQL statements may always be manually entered and edited, the&nbsp;<strong>Rhapsody Database Configuration Editor</strong>&nbsp;can automatically generate the basis of some commonly used queries. This is done by selecting a table in the Server Explorer, then selecting the&nbsp;<strong>Generate SQL</strong>&nbsp;button as shown in the following diagram:</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/148510896.png" data-image-src="attachments/133161696/148510896.png" data-unresolved-comment-count="0" data-linked-resource-id="148510896" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="serverExplorerSqlGeneration.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span></p>
      <p>This enables you to generate an SQL&nbsp;<code>SELECT</code>,&nbsp;<code>INSERT</code>, or&nbsp;<code>UPDATE</code>&nbsp;query from the database structure. The base query can then be modified as desired.</p>
      <p>Alternatively, you can automatically generate an SQL query, by right-clicking and dragging a database table from the server explorer onto the SQL text editor. A context menu is then displayed, which enables you to select the type of SQL query to be generated:</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/148510897.png" data-image-src="attachments/133161696/148510897.png" data-unresolved-comment-count="0" data-linked-resource-id="148510897" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="sqlEditorSqlGeneration.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span></p>
      <div class="confluence-information-macro confluence-information-macro-note">
       <span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
       <div class="confluence-information-macro-body">
        <p>In Rhapsody, repeating&nbsp;SQL&nbsp;spaces are trimmed. The only exceptions are SQL strings with quotes, inside which spaces are not removed during parsing. <span><span>For example, the three spaces in the </span>quotes <span>are preserved in the following query: </span></span><code>SELECT PatientID FROM patient WHERE SpecialField = 'Part1 &nbsp; Part2'</code>.</p>
       </div>
      </div>
      <h2 id="SQLEditor-ParameterizingSQLStatements">Parameterizing&nbsp;SQL Statements</h2>
      <p>SQL statements can be parameterized using values retrieved from the incoming message:</p>
      <div class="table-wrap">
       <table id="TBL1565043148455" class="wrapped confluenceTable" width="100%">
        <colgroup>
         <col>
         <col>
         <col>
        </colgroup>
        <tbody>
         <tr>
          <th class="confluenceTh"><p>To use a...</p></th>
          <th class="confluenceTh"><p>Usage</p></th>
          <th class="confluenceTh"><p>Example</p></th>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Message Property</p></td>
          <td class="confluenceTd">
           <div class="content-wrapper">
            <p>Insert a dollar sign (<code>$</code>) in front of the message property name.</p>
            <div class="confluence-information-macro confluence-information-macro-information">
             <span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
             <div class="confluence-information-macro-body">
              <p>Dynamic table and column names may be specified in a database SQL statement using message properties. Refer to <a href="Using-Dynamic-Table-and-Column-Names_133161686.html">Using Dynamic Table and Column Names</a> for details.</p>
             </div>
            </div>
           </div></td>
          <td class="confluenceTd"><p><code>$myProperty</code></p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Field Within an EDI Message</p></td>
          <td class="confluenceTd"><p>Insert an at sign (<code>@</code>) in front of the full path to the message field.</p></td>
          <td class="confluenceTd"><p><code>@PID.PatientName[0].FamilyName.Surname</code></p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Field Within an XML Message</p></td>
          <td class="confluenceTd"><p>Surround the XPath with backquotes (<code>`</code>).</p></td>
          <td class="confluenceTd"><p><code>`/ADT_A01/NK1[1]/NK1.1`</code></p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Column From a Previous Resultset</p></td>
          <td class="confluenceTd"><p>Insert an at sign (<code>@</code>) in front of the column name.</p></td>
          <td class="confluenceTd"><p><code>@PatientName</code></p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Stored Procedure Output Parameter</p></td>
          <td class="confluenceTd"><p>Insert a hash sign (<code>#</code>) in front of the parameter name.</p></td>
          <td class="confluenceTd"><p><code>#newPatientId</code></p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Message Body as a String</p></td>
          <td class="confluenceTd"><p>Insert <code>$messageContent</code>.</p></td>
          <td class="confluenceTd"><p><code>$messageContent</code></p></td>
         </tr>
        </tbody> 
        <script type="text/javascript">

$("table[id='TBL1565043148455']").data("appfire-table","true");
(new org_swift_TableSorter()).customTable('TBL1565043148455',[],'style=&quot;width:25%; text-align: left;&quot;',
1,'',true,
'Click to sort','',false,
false,false,false,
0,false,'',true,
'',false,false,'','100%','','',
true,'',
''
);

</script> 
       </table>
      </div>
      <h2 id="SQLEditor-InsertingMessageFieldsMessageFields">Inserting Message Fields <span class="confluence-anchor-link" id="SQLEditor-MessageFields"></span></h2>
      <p>While it is possible to type in message field paths manually, it is recommended that instead message paths be inserted automatically. This reduces the chance of an incorrect path being used and allows the Rhapsody™ Database Configuration Editor to automatically take account of statement iteration when generating message paths.</p>
      <p>Message paths can be inserted into the SQL in two ways. Firstly, the <strong>Insert Field</strong> button can be pressed to launch a field selector dialog, which allows a specific field to be selected and inserted at the current cursor location.</p>
      <p>Secondly, fields can be selected by dragging the appropriate field from the <strong>Message Structure</strong> toolbar onto the desired location in the text editor. This generates the appropriate field path and inserts it. This is shown in the following screenshot:</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/133161698.png" data-image-src="attachments/133161696/133161698.png" data-unresolved-comment-count="0" data-linked-resource-id="133161698" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="sqlEditorDraggingField.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span></p>
      <h2 id="SQLEditor-InsertingPriorResults">Inserting Prior Results</h2>
      <p>Complex database configurations frequently perform a number of related queries. The parameters of some queries may at times depend on the results of previous queries. The Database Configuration Editor provides the ability to insert results generated from previous queries to make it easier to access these values. These are accessed from the <strong>Insert Prior Result</strong> toolbar button as shown in the following screenshot:</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/133161699.png" data-image-src="attachments/133161696/133161699.png" data-unresolved-comment-count="0" data-linked-resource-id="133161699" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="sqlEditorInsertPriorResult.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span></p>
      <p>Selecting a prior result automatically inserts the appropriate value (with the correct prefix depending on its type) at the current cursor location in the text editor. When the SQL Editor is opened, available prior results for all previous statements are located and added to the menu.</p>
      <p>At present, the only types of prior results found are declared output parameters for stored procedure calls, and any columns whose values are saved using result substitution. However, this will be extended in future to allow access to all columns returned via any result set.</p>
      <h2 id="SQLEditor-StatementOptions">Statement Options</h2>
      <p>The <strong>Statement Options</strong>&nbsp;dialog&nbsp;enables you to configure how a statement is executed:</p>
      <p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/133161696/133161697.png" data-image-src="attachments/133161696/133161697.png" data-unresolved-comment-count="0" data-linked-resource-id="133161697" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="statementOptions.png" data-base-url="https://docs.rhapsody.health" data-linked-resource-content-type="image/png" data-linked-resource-container-id="133161696" data-linked-resource-container-version="4"></span></p>
      <p><br></p>
      <div class="table-wrap">
       <table id="TBL1565043148456" class="wrapped confluenceTable" width="100%">
        <colgroup>
         <col>
         <col>
        </colgroup>
        <tbody>
         <tr>
          <th class="confluenceTh"><p>Field</p></th>
          <th class="confluenceTh"><p>Description</p></th>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Statement Execution Method</p></td>
          <td class="confluenceTd"><p>This option determines which JDBC execution method is used to run the statement. The available options of <code>execute</code>, <code>executeQuery</code>, and <code>executeUpdate</code> correspond to the methods of the same name on the <code>java.sql.Statement</code> interface. This option should only be changed from the default if the database driver being used requires updates and queries to be explicitly signaled by calling the correct method. Neither the standard SQL Server or Oracle® drivers require this. This option is not available for stored procedure calls.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Maximum Result Rows</p></td>
          <td class="confluenceTd"><p>This option limits the number of rows returned in a result set. This option can be used to protect against unexpected overflow from a <code>SELECT</code> statement, and can be set to any positive value. The default of <code>0</code> (zero) indicates that there is no maximum number of result rows.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Allow Compound Statements</p></td>
          <td class="confluenceTd"><p>This option determines whether the Database Configuration Editor allows <a href="Compound-SQL-Statements_133161695.html">Compound Statements</a> separated by semicolons for this particular statement. Compound statements are used to define two (or more) closely related statements together, where they are tightly coupled. For example, if some values are being inserted into a SQL Server table with an identity column, the <code>INSERT</code> statement to insert the values, and the <code>SELECT</code> statement to retrieve the new identifier, can be defined together. If this option is disabled, the Database Configuration Editor will ignore semicolons and treat them as part of a single statement. This option should generally be left on, but is unavailable for stored procedure calls.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>Raise an error if the query returns no results</p></td>
          <td class="confluenceTd"><p>This option is used when using a <span>Database Lookup</span> filter to perform result substitution (inserting values returned from a query into the message) when a query unexpectedly returns no results.</p><p>If this field is selected (the default), an error is raised and execution of the remaining statements is canceled. If this field is not selected, the default values (if available) for result substitution are used instead, and no error is raised.</p></td>
         </tr>
         <tr>
          <td class="confluenceTd"><p>On Multiple Results</p></td>
          <td class="confluenceTd"><p>This option is used when using a Database Lookup filter to perform result substitution (inserting values returned from a query into the message) in the event a query returns multiple results. You can select from one of the following modes:</p>
           <ul>
            <li><p><code>Throw Error</code> (default) - an error is raised if a result substitution query returns multiple results.</p></li>
            <li><p><code>Read First Result</code> - the first row<span>&nbsp;</span>is read, and any subsequent rows are ignored.</p></li>
            <li><p><code>Read All Results</code> - all rows are read, and the <code>&lt;resultSet&gt;ReadAllLines&lt;/resultSet</code>&gt; element is added to the <code>&lt;statement&gt;</code> element. To enable or disable <span>the populating of repeating fields using all results, check or uncheck, respectively, the</span> <strong>Append</strong> checkbox which is provided in the Result Substitution table for this mode.</p></li>
           </ul></td>
         </tr>
        </tbody> 
        <script type="text/javascript">

$("table[id='TBL1565043148456']").data("appfire-table","true");
(new org_swift_TableSorter()).customTable('TBL1565043148456',[],'style=&quot;width:20%; text-align: left;&quot;',
1,'',true,
'Click to sort','',false,
false,false,false,
0,false,'',true,
'',false,false,'','100%','','',
true,'',
''
);

</script> 
       </table>
      </div>
      <p> </p> 
     </div>  
    </div> 
   </div>  
  </div>   
 </body>
</html>