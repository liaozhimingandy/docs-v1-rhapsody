<!doctype html>
<html>
 <head> 
  <title>Compound SQL Statements</title> 
  <link rel="stylesheet" href="styles/site.css" type="text/css"> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <link rel="stylesheet" href="styles/icons.css" type="text/css">
  <script src="js/jquery.min.js"></script>
  <script src="tree/collapsibleTreeMenu.js"></script>
  <link href="tree/collapsibleTreeMenu.css" rel="stylesheet" type="text/css">
 </head> 
 <body class="theme-default aui-theme-default"> 
  <div id="page"> 
   <div id="main" class="aui-page-panel"> 
    <div id="main-header"> 
     <div id="breadcrumb-section"> 
      <ol id="breadcrumbs">  
       <li> <span><a href="Rhapsody-Integration-Engine-6.5_133160975.html">Rhapsody Integration Engine 6.5</a></span> </li> 
       <li> <span><a href="Developing-Rhapsody_133161055.html">Developing Rhapsody</a></span> </li> 
       <li> <span><a href="Database-Configuration_133161571.html">Database Configuration</a></span> </li> 
      </ol> 
     </div> 
     <h1 id="title-heading" class="pagetitle"> <span id="title-text">Compound SQL Statements</span> </h1> 
    </div> 
    <div id="content" class="view">  
     <div id="main-content" class="wiki-content group"> 
      <p>The <strong>Rhapsody Database Configuration Editor</strong> supports having multiple SQL commands within a single 'statement'. This allows closely related commands to be kept together, and is particularly intended for using foreign keys, and automatically generated identities and sequences. For example, in SQL Server, you may perform an insert such as:</p>
      <div class="preformatted panel" style="border-width: 1px;">
       <div class="preformattedContent panelContent"> 
        <pre>INSERT INTO NextOfKin (PatientID, FamilyName, GivenName, Sex, Relationship, PhoneNumber)
   VALUES (
      @PID.PatientID.IDNumber,
      @NKL.NextOfKinName[0].FamilyName.Surname,
      @NKL.NextOfKinName[0].GivenName,
      @NKL.Sex,@NKL.ContactRole.Identifier,
      @NKL.PhoneNUmber[0].PhoneNumber.PhoneNumber,
)
</pre> 
       </div>
      </div>
      <p>Assuming that the <strong>NextOfKin</strong> table had an identity column as the primary key, the newly allocated identifier could then be retrieved using the following SQL statement, and then used in subsequent statements:</p>
      <div class="preformatted panel" style="border-width: 1px;">
       <div class="preformattedContent panelContent"> 
        <pre>SELECT @@IDENTITY As NextOfKinID </pre> 
       </div>
      </div>
      <p>Previously these closely coupled statements would have to be defined seperately, and then manually kept together. The <strong>Rhapsody Database Configuration Editor</strong> allows compound statements to be defined for any SQL statement (but not stored procedure calls).</p>
      <p>Multiple statements are separated using a semi-colon (semi-colons defined within string literals or comments are ignored). The compound statement for the example above is shown below:</p>
      <div class="preformatted panel" style="border-width: 1px;">
       <div class="preformattedContent panelContent"> 
        <pre>INSERT INTO NextOfKin (PatientID, FamilyName, GivenName, Sex, Relationship, PhoneNumber)
   VALUES (
      @PID.PatientID.IDNumber,
      @NKL.NextOfKinName[0].FamilyName.Surname,
      @NKL.NextOfKinName[0].GivenName,
      @NKL.Sex,@NKL.ContactRole.Identifier,
      @NKL.PhoneNUmber[0].PhoneNumber.PhoneNumber,
);
SELECT @@IDENTITY AS NextOfKinID
</pre> 
       </div>
      </div>
      <p></p>
      <p>The example above first performs the SQL insert into the <strong>NextOfKin</strong> table. The first column in that table is defined as a SQL Server identity column, and so its value is automatically generated by the database. The subsequent line then retrieves the most recently allocated identifier within the current transaction and returns it as <code>NextOfKinId</code>. This 'column' can then be used in <a href="Result-Substitution_133161688.html">Result Substitution</a>, or used by subsequent queries.</p>
      <p> </p> 
     </div> 
    </div> 
   </div>  
  </div>   
 </body>
</html>